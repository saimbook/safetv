<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>ржЧрж╛рж░рзНржорзЗржирзНржЯрж╕ ржлрзНржпрж╛ржХрзНржЯрж░рж┐ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family: Arial;
  background:#eef3fb;
  margin:0;
}
header{
  background:#0d47a1;
  color:#fff;
  padding:15px;
  display:flex;
  align-items:center;
}
.logo{
  width:45px;height:45px;
  background:#fff;
  color:#0d47a1;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  margin-right:10px;
}
.container{padding:15px}
.card{
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
}
button{
  background:#1565c0;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:7px 12px;
  margin:4px 0;
}
input{
  width:100%;
  padding:7px;
  margin:5px 0;
}
.closed{opacity:.6;background:#eee}
.small{font-size:13px;color:#555}
</style>
</head>
<body>

<header>
  <div class="logo">FG</div>
  <div>
    <div><b>Factory Garments Ltd.</b></div>
    <div class="small">рж▓рж╛ржЗржн ржЗржиржнрзЗржирзНржЯрж░рж┐ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб</div>
  </div>
</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h3>ЁЯФР рж▓ржЧржЗржи ржХрж░рзБржи</h3>
  <input id="username" placeholder="ржЗржЙржЬрж╛рж░ржирзЗржо">
  <input id="password" type="password" placeholder="ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб">
  <button onclick="login()">рж▓ржЧржЗржи</button>
</div>

<!-- ADMIN -->
<div id="adminPanel" style="display:none">

<div class="card">
<h3>тЮХ ржирждрзБржи рж╕рзНржЯрж╛ржЗрж▓ ржпрзЛржЧ ржХрж░рзБржи</h3>
<input id="buyer" placeholder="Buyer Name">
<input id="po" placeholder="PO Number">
<input id="shipment" placeholder="Shipment No">
<input id="style" placeholder="Style Name">
<input id="lot" placeholder="LOT / LOAD No">
<input id="indexNo" placeholder="Index No">
<input id="colors" placeholder="Colors (Red,Black,Blue)">
<input id="sizes" placeholder="Sizes (S,M,L,XL,XXL)">
<input id="pcs" placeholder="PCS per Carton">
<button onclick="addStyle()">рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи</button>
</div>

<div class="card">
<h3>ЁЯУК ржлрзНржпрж╛ржХрзНржЯрж░рж┐ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк</h3>
ржорзЛржЯ рж╕рзНржЯрж╛ржЗрж▓: <span id="kStyle">0</span> |
ржорзЛржЯ ржХрж╛рж░рзНржЯрзБржи: <span id="kCarton">0</span> |
ржорзЛржЯ ржкрж┐рж╕: <span id="kPCS">0</span>
</div>

<input placeholder="ЁЯФН Buyer / PO / LOT / Index рж╕рж╛рж░рзНржЪ"
onkeyup="searchStyle(this.value)">

<div id="adminStyles"></div>

<div class="card">
<h3>ЁЯТм ржЗржЙржЬрж╛рж░ ржоржирзНрждржмрзНржп</h3>
<div id="commentList"></div>
</div>

<button onclick="logout()">рж▓ржЧржЖржЙржЯ</button>
</div>

<!-- USER -->
<div id="userPanel" style="display:none">
<input placeholder="ЁЯФН рж╕рж╛рж░рзНржЪ ржХрж░рзБржи" onkeyup="searchStyle(this.value)">
<div id="userStyles"></div>
<button onclick="logout()">рж▓ржЧржЖржЙржЯ</button>
</div>

</div>

<script>
/* Firebase Config */
firebase.initializeApp({
  apiKey: "AIzaSyDJCr4z7qwvCxP-t50wHTtMxB95T3S7_SY",
  authDomain: "safe-46480.firebaseapp.com",
  databaseURL: "https://safe-46480-default-rtdb.firebaseio.com",
  projectId: "safe-46480",
  storageBucket: "safe-46480.firebasestorage.app",
  messagingSenderId: "612208138762",
  appId: "1:612208138762:web:b53f1d26b7f9322c94ddf3"
});
const db=firebase.database();
let role="";

/* LOGIN */
function login(){
  let u=username.value,p=password.value;
  if(u==="admin"){
    db.ref("admin/password").get().then(s=>{
      if(s.val()===p){
        role="admin";
        loginBox.style.display="none";
        adminPanel.style.display="block";
        loadAdmin(); loadComments();
      }else alert("ржнрзБрж▓ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб");
    });
  }else{
    role="staff";
    loginBox.style.display="none";
    userPanel.style.display="block";
    loadUser();
  }
}
function logout(){location.reload();}

/* ADD STYLE */
function addStyle(){
  if(!style.value||!lot.value||!indexNo.value)return alert("рж╕ржм рждржерзНржп ржжрж┐ржи");
  db.ref("styles").push({
    buyer:buyer.value,po:po.value,shipment:shipment.value,
    style:style.value,lot:lot.value,index:indexNo.value,
    colors:colors.value.split(","),sizes:sizes.value.split(","),
    pcsPerCarton:Number(pcs.value),totalCarton:0,closed:false
  });
  buyer.value=po.value=shipment.value=style.value=lot.value=
  indexNo.value=colors.value=sizes.value=pcs.value="";
}

/* RECEIVE */
function receiveCarton(id){
  let q=prompt("ржХржд ржХрж╛рж░рзНржЯрзБржи ржЧрзНрж░рж╣ржг?");
  if(!q)return;
  db.ref("styles/"+id+"/totalCarton")
  .transaction(c=>(c||0)+Number(q));
}

/* CLOSE */
function closeStyle(id){
  db.ref("styles/"+id+"/closed").set(true);
  alert("рж╢рж┐ржкржорзЗржирзНржЯ ржмржирзНржз рж╣ржпрж╝рзЗржЫрзЗ");
}

/* COMMENT */
function comment(s,l,i){
  let m=prompt("ржоржирзНрждржмрзНржп рж▓рж┐ржЦрзБржи");
  if(!m)return;
  db.ref("comments").push({style:s,lot:l,index:i,message:m});
}

/* LOAD ADMIN */
function loadAdmin(){
db.ref("styles").on("value",s=>{
adminStyles.innerHTML="";let a=[],c=0,p=0;
s.forEach(x=>{
let v=x.val(),pcs=v.totalCarton*v.pcsPerCarton;
a.push(v);c+=v.totalCarton;p+=pcs;
adminStyles.innerHTML+=`
<div class="card ${v.closed?'closed':''}">
<b>${v.style}</b> | Buyer: ${v.buyer}<br>
PO:${v.po} | Ship:${v.shipment}<br>
LOT:${v.lot} | IDX:${v.index}<br>
ЁЯУж ${v.totalCarton} | ЁЯСХ ${pcs}<br>
${v.closed?"ЁЯФТ ржмржирзНржз":
`<button onclick="receiveCarton('${x.key}')">+ ржХрж╛рж░рзНржЯрзБржи ржЧрзНрж░рж╣ржг</button>
<button onclick="closeStyle('${x.key}')">ЁЯЪЪ ржХрзНрж▓рзЛржЬ</button>`}
<button onclick="downloadPDF(${JSON.stringify(v)})">ЁЯУД PDF</button>
</div>`;
});
kStyle.innerText=a.length;kCarton.innerText=c;kPCS.innerText=p;
});
}

/* LOAD USER */
function loadUser(){
db.ref("styles").on("value",s=>{
userStyles.innerHTML="";
s.forEach(x=>{
let v=x.val(),pcs=v.totalCarton*v.pcsPerCarton;
userStyles.innerHTML+=`
<div class="card ${v.closed?'closed':''}">
<b>${v.style}</b><br>
LOT:${v.lot} | IDX:${v.index}<br>
ЁЯУж ${v.totalCarton} | ЁЯСХ ${pcs}<br>
${v.closed?"ЁЯФТ ржмржирзНржз":
`<button onclick="comment('${v.style}','${v.lot}','${v.index}')">ЁЯТм ржоржирзНрждржмрзНржп</button>`}
</div>`;
});
});
}

/* COMMENTS */
function loadComments(){
db.ref("comments").on("value",s=>{
commentList.innerHTML="";
s.forEach(c=>{
let v=c.val();
commentList.innerHTML+=`
<div class="small">
<b>${v.style}</b> (${v.lot}/${v.index})<br>
ЁЯТм ${v.message}
</div>`;
});
});
}

/* SEARCH */
function searchStyle(t){
t=t.toLowerCase();
document.querySelectorAll(".card").forEach(c=>{
c.style.display=c.innerText.toLowerCase().includes(t)?"block":"none";
});
}

/* PDF */
function downloadPDF(v){
const {jsPDF}=window.jspdf;
let p=new jsPDF();
p.text("GARMENTS SUMMARY",20,20);
p.text("Style: "+v.style,20,30);
p.text("LOT: "+v.lot+" Index: "+v.index,20,40);
p.text("Buyer: "+v.buyer,20,50);
p.text("Carton: "+v.totalCarton,20,60);
p.text("PCS: "+(v.totalCarton*v.pcsPerCarton),20,70);
p.save(v.style+"_summary.pdf");
}
</script>

</body>
</html>
