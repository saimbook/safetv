<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calculator</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #f2f2f2;
            font-family: Arial, sans-serif;
        }

        .calculator {
            background: #222;
            padding: 20px;
            border-radius: 12px;
            width: 260px;
        }

        #display {
            width: 100%;
            height: 50px;
            font-size: 24px;
            margin-bottom: 10px;
            text-align: right;
            padding: 5px;
            border: none;
            border-radius: 6px;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        button {
            height: 50px;
            font-size: 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            opacity: 0.85;
        }

        .operator {
            background: orange;
            color: white;
        }

        .equal {
            background: green;
            color: white;
            grid-column: span 2;
        }

        .clear {
            background: red;
            color: white;
            grid-column: span 2;
        }
    </style>
</head>
<body>

<div class="calculator">
    <input type="text" id="display" disabled>

    <div class="buttons">
        <button onclick="clearDisplay()" class="clear">C</button>
        <button onclick="append('/') " class="operator">√∑</button>
        <button onclick="append('*')" class="operator">√ó</button>

        <button onclick="append('7')">7</button>
        <button onclick="append('8')">8</button>
        <button onclick="append('9')">9</button>
        <button onclick="append('-')" class="operator">-</button>

        <button onclick="append('4')">4</button>
        <button onclick="append('5')">5</button>
        <button onclick="append('6')">6</button>
        <button onclick="append('+')" class="operator">+</button>

        <button onclick="append('1')">1</button>
        <button onclick="append('2')">2</button>
        <button onclick="append('3')">3</button>
        <button onclick="append('.')">.</button>

        <button onclick="append('0')">0</button>
        <button onclick="calculate()" class="equal">=</button>
    </div>
</div>

<script>
    const display = document.getElementById("display");

    function append(value) {
        display.value += value;
    }

    function clearDisplay() {
        display.value = "";
    }

    function calculate() {
        try {
            display.value = eval(display.value);
        } catch {
            display.value = "Error";
        }
    }
</script>

</body>
</html>}
.container{padding:15px}
.card{
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
}
button{
  background:#1565c0;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:7px 12px;
  margin:4px 0;
}
input{
  width:100%;
  padding:7px;
  margin:5px 0;
}
.closed{opacity:.6;background:#eee}
.small{font-size:13px;color:#555}
</style>
</head>
<body>

<header>
  <div class="logo">FG</div>
  <div>
    <div><b>Factory Garments Ltd.</b></div>
    <div class="small">‡¶≤‡¶æ‡¶á‡¶≠ ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>
  </div>
</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h3>üîê ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
  <input id="username" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ">
  <input id="password" type="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
  <button onclick="login()">‡¶≤‡¶ó‡¶á‡¶®</button>
</div>

<!-- ADMIN -->
<div id="adminPanel" style="display:none">

<div class="card">
<h3>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
<input id="buyer" placeholder="Buyer Name">
<input id="po" placeholder="PO Number">
<input id="shipment" placeholder="Shipment No">
<input id="style" placeholder="Style Name">
<input id="lot" placeholder="LOT / LOAD No">
<input id="indexNo" placeholder="Index No">
<input id="colors" placeholder="Colors (Red,Black,Blue)">
<input id="sizes" placeholder="Sizes (S,M,L,XL,XXL)">
<input id="pcs" placeholder="PCS per Carton">
<button onclick="addStyle()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="card">
<h3>üìä ‡¶´‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶∞‡¶ø ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h3>
‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤: <span id="kStyle">0</span> |
‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßÅ‡¶®: <span id="kCarton">0</span> |
‡¶Æ‡ßã‡¶ü ‡¶™‡¶ø‡¶∏: <span id="kPCS">0</span>
</div>

<input placeholder="üîç Buyer / PO / LOT / Index ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö"
onkeyup="searchStyle(this.value)">

<div id="adminStyles"></div>

<div class="card">
<h3>üí¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</h3>
<div id="commentList"></div>
</div>

<button onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
</div>

<!-- USER -->
<div id="userPanel" style="display:none">
<input placeholder="üîç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®" onkeyup="searchStyle(this.value)">
<div id="userStyles"></div>
<button onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
</div>

</div>

<script>
/* Firebase Config */
firebase.initializeApp({
  apiKey: "AIzaSyDJCr4z7qwvCxP-t50wHTtMxB95T3S7_SY",
  authDomain: "safe-46480.firebaseapp.com",
  databaseURL: "https://safe-46480-default-rtdb.firebaseio.com",
  projectId: "safe-46480",
  storageBucket: "safe-46480.firebasestorage.app",
  messagingSenderId: "612208138762",
  appId: "1:612208138762:web:b53f1d26b7f9322c94ddf3"
});
const db=firebase.database();
let role="";

/* LOGIN */
function login(){
  let u=username.value,p=password.value;
  if(u==="admin"){
    db.ref("admin/password").get().then(s=>{
      if(s.val()===p){
        role="admin";
        loginBox.style.display="none";
        adminPanel.style.display="block";
        loadAdmin(); loadComments();
      }else alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°");
    });
  }else{
    role="staff";
    loginBox.style.display="none";
    userPanel.style.display="block";
    loadUser();
  }
}
function logout(){location.reload();}

/* ADD STYLE */
function addStyle(){
  if(!style.value||!lot.value||!indexNo.value)return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
  db.ref("styles").push({
    buyer:buyer.value,po:po.value,shipment:shipment.value,
    style:style.value,lot:lot.value,index:indexNo.value,
    colors:colors.value.split(","),sizes:sizes.value.split(","),
    pcsPerCarton:Number(pcs.value),totalCarton:0,closed:false
  });
  buyer.value=po.value=shipment.value=style.value=lot.value=
  indexNo.value=colors.value=sizes.value=pcs.value="";
}

/* RECEIVE */
function receiveCarton(id){
  let q=prompt("‡¶ï‡¶§ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶π‡¶£?");
  if(!q)return;
  db.ref("styles/"+id+"/totalCarton")
  .transaction(c=>(c||0)+Number(q));
}

/* CLOSE */
function closeStyle(id){
  db.ref("styles/"+id+"/closed").set(true);
  alert("‡¶∂‡¶ø‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
}

/* COMMENT */
function comment(s,l,i){
  let m=prompt("‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");
  if(!m)return;
  db.ref("comments").push({style:s,lot:l,index:i,message:m});
}

/* LOAD ADMIN */
function loadAdmin(){
db.ref("styles").on("value",s=>{
adminStyles.innerHTML="";let a=[],c=0,p=0;
s.forEach(x=>{
let v=x.val(),pcs=v.totalCarton*v.pcsPerCarton;
a.push(v);c+=v.totalCarton;p+=pcs;
adminStyles.innerHTML+=`
<div class="card ${v.closed?'closed':''}">
<b>${v.style}</b> | Buyer: ${v.buyer}<br>
PO:${v.po} | Ship:${v.shipment}<br>
LOT:${v.lot} | IDX:${v.index}<br>
üì¶ ${v.totalCarton} | üëï ${pcs}<br>
${v.closed?"üîí ‡¶¨‡¶®‡ßç‡¶ß":
`<button onclick="receiveCarton('${x.key}')">+ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßÅ‡¶® ‡¶ó‡ßç‡¶∞‡¶π‡¶£</button>
<button onclick="closeStyle('${x.key}')">üöö ‡¶ï‡ßç‡¶≤‡ßã‡¶ú</button>`}
<button onclick="downloadPDF(${JSON.stringify(v)})">üìÑ PDF</button>
</div>`;
});
kStyle.innerText=a.length;kCarton.innerText=c;kPCS.innerText=p;
});
}

/* LOAD USER */
function loadUser(){
db.ref("styles").on("value",s=>{
userStyles.innerHTML="";
s.forEach(x=>{
let v=x.val(),pcs=v.totalCarton*v.pcsPerCarton;
userStyles.innerHTML+=`
<div class="card ${v.closed?'closed':''}">
<b>${v.style}</b><br>
LOT:${v.lot} | IDX:${v.index}<br>
üì¶ ${v.totalCarton} | üëï ${pcs}<br>
${v.closed?"üîí ‡¶¨‡¶®‡ßç‡¶ß":
`<button onclick="comment('${v.style}','${v.lot}','${v.index}')">üí¨ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</button>`}
</div>`;
});
});
}

/* COMMENTS */
function loadComments(){
db.ref("comments").on("value",s=>{
commentList.innerHTML="";
s.forEach(c=>{
let v=c.val();
commentList.innerHTML+=`
<div class="small">
<b>${v.style}</b> (${v.lot}/${v.index})<br>
üí¨ ${v.message}
</div>`;
});
});
}

/* SEARCH */
function searchStyle(t){
t=t.toLowerCase();
document.querySelectorAll(".card").forEach(c=>{
c.style.display=c.innerText.toLowerCase().includes(t)?"block":"none";
});
}

/* PDF */
function downloadPDF(v){
const {jsPDF}=window.jspdf;
let p=new jsPDF();
p.text("GARMENTS SUMMARY",20,20);
p.text("Style: "+v.style,20,30);
p.text("LOT: "+v.lot+" Index: "+v.index,20,40);
p.text("Buyer: "+v.buyer,20,50);
p.text("Carton: "+v.totalCarton,20,60);
p.text("PCS: "+(v.totalCarton*v.pcsPerCarton),20,70);
p.save(v.style+"_summary.pdf");
}
</script>

</body>
</html>
